steps:
  - id: "Installing Go"
    name: "gcr.io/cloud-builders/go"
    args: ["install", "./src"]
    env: ["PROJECT_ROOT=main"]

  - id: "Testing"
    name: "gcr.io/cloud-builders/go"
    args: ["test", "./src"]
    env: ["PROJECT_ROOT=main"]

  - id: "Building image from Dockerfile.prod"
    name: "gcr.io/cloud-builders/docker"
    args: ["build","-t","gcr.io/$PROJECT_ID/go-cicd:$SHORT_SHA","-f","Dockerfile.prod","src/"]

  - id: "Pushing image"
    name: "gcr.io/cloud-builders/docker"
    args: ["push","gcr.io/$PROJECT_ID/go-cicd:$SHORT_SHA"]
